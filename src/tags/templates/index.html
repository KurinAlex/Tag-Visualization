<!DOCTYPE html>
<html>
<head>
    <title>JSON Rectangle Viewer</title>
    <style>
        canvas { border: 1px solid black; }
    </style>
</head>
<body>
    <h1>Upload JSON File</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form }}
        <button type="submit">Upload</button>
    </form>

    {% if rectangles %}
        <h2>Canvas Output</h2>
        <canvas id="canvas" width="800" height="600"></canvas>
        <script>
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            const rectangles = {{ rectangles|safe }};

            const padX = 10;
            const padY = 10;

            const minX = Math.min(...rectangles.map(r => r.x));
            const maxX = Math.max(...rectangles.map(r => r.x + r.width));
            const minY = Math.min(...rectangles.map(r => r.y));
            const maxY = Math.max(...rectangles.map(r => r.y + r.height));

            const scaleX = (canvas.width - 2 * padX) / (maxX - minX);
            const scaleY = (canvas.height - 2 * padY)/ (maxY - minY);

            rectangles.forEach(rect => {
                ctx.beginPath();
                ctx.rect((rect.x - minX) * scaleX + padX, (rect.y - minY) * scaleY + padY, rect.width * scaleX, rect.height * scaleY);
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.fillStyle = 'rgba(0, 0, 255, 0.1)';
                ctx.fill();
            });
        </script>
    {% endif %}
</body>
</html>
